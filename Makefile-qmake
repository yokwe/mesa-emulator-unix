#
# Makefile-qmake
#

MODULE := main test guam-headless \
          util mesa agent opcode trace symbols xns courier courierImpl xnsDump xnsServer xnsServerImpl \
          dumpSymbol

.PHONY: qmake5 qmake6
.PHONY:     main     test     xnsDump     xnsServer
.PHONY: run-main run-test run-xnsDump run-xnsServer
.PHONY:     guam-headless prepare-run-guam
.PONEY: run-guam-headless-gvwin run-guam-headless-gvwin21 run-guam-headless-dawn
.PHONY: util mesa symbols xns courier
.PHONY: dumpSymbol run-dumpSymbol


qmake:
	@echo "MODULE $(MODULE)!"
	@for i in $(MODULE); do echo "cd src/$$i; qmake"; (cd src/$$i; qmake); done

qmake5:
	@echo "MODULE $(MODULE)!"
	@for i in $(MODULE); do echo "cd src/$$i; qmake"; (cd src/$$i; qmake-qt5); done

qmake6:
	@echo "MODULE $(MODULE)!"
	@for i in $(MODULE); do echo "cd src/$$i; qmake"; (cd src/$$i; qmak6); done

util:
	( cd src/util; make all )

main: util
	( cd src/main; make all )


mesa: util
	( cd src/agent; make all )
	( cd src/opcode; make all )
	( cd src/mesa; make all )
	( cd src/trace; make all )

test: util mesa
	( cd src/test; make all )

symbols: util mesa
	( cd src/symbols; make all )

xns: util
	( cd src/xns; make all )
	( cd src/courier; make all )

xnsServer: xns
	( cd src/xnsServerImpl; make all )
	( cd src/courierImpl; make all )
	( cd src/xnsServer; make all )

xnsDump: xns
	( cd src/xnsDump; make all )

guam-headless: util mesa
	( cd src/guam-headless; make all )
	
dumpSymbol: symbols util
	( cd src/dumpSymbol; make all )

run-xnsServer: xnsServer
	echo -n >tmp/run/debug.log
	tmp/build/xnsServer/xnsServer

run-xnsDump: xnsDump
	echo -n >tmp/run/debug.log
	tmp/build/xnsDump/xnsDump
